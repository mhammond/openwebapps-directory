This is a basic functional test of the application.

First, the index page:

    >>> resp = app.get('/')
    >>> # Because we don't have any apps, we shouldn't have Featured Apps:
    >>> resp.mustcontain(no='Featured Apps')
    >>> resp = app.get('/add')
    >>> import json
    >>> add_resource('http://test1.com/manifest.webapp',
    ...              json.dumps(dict(name='Test app')))
    >>> add_form = resp.forms['add-form']
    >>> add_form['manifest_url'] = 'http://test1.com/manifest.webapp'
    >>> resp = add_form.submit(status=302)
    >>> print resp.location
    http://localhost/app/test1.com/test-app
    >>> add_resource('http://test2.com/manifest.webapp',
    ...              json.dumps(dict(origin='http://test2.com')))
    >>> add_form['manifest_url'] = 'http://test2.com/manifest.webapp'
    >>> resp = add_form.submit()
    >>> resp.mustcontain('The name property is required')
    >>> resp = app.get('/')
    >>> resp.mustcontain('Test app')

Now to test the removal:

    >>> import urllib2
    >>> resp = app.get('/add')
    >>> form = resp.forms['remove-form']
    >>> add_resource('http://test1.com/manifest.webapp',
    ...              urllib2.HTTPError('http://test1.com/manifest.webapp',
    ...                                400, 'whatever', None, None))
    >>> form['remove_manifest_url'] = 'http://test1.com/manifest.webapp'
    >>> resp = form.submit()
    >>> resp.mustcontain('The url must return 404')
    >>> add_resource('http://test1.com/manifest.webapp',
    ...              urllib2.HTTPError('http://test1.com/manifest.webapp',
    ...                                404, 'not found', None, None))
    >>> resp = form.submit()
    >>> resp = app.get('/')
    >>> resp.mustcontain(no='Test app')

And test emails:

    >>> add_resource('http://test3.com/manifest.webapp',
    ...              json.dumps(dict(name='Test Email App', developer=dict(email='test@example.com'))))
    >>> resp = app.get('/add')
    >>> resp.forms['add-form']['manifest_url'] = 'http://test3.com/manifest.webapp'
    >>> resp = resp.forms['add-form'].submit()
    >>> print resp.location
    http://localhost/app/test3.com/test-email-app
    >>> resp = app.get('/admin/emails', status=404)
    >>> app.extra_environ['x-wsgiorg.developer_user'] = 'test'
    >>> resp = app.get('/admin/emails')
    >>> resp.mustcontain('test@example.com')
    >>>
